# DerbyNet Rsyslog Client Configuration
# File: /etc/rsyslog.d/20-derbynet-client.conf
# Purpose: Configure remote devices to forward DerbyNet logs to central server

# Forward DerbyNet logs (local0 facility) to central server
# Replace 192.168.100.10 with your derbynetpi IP address if different
*.local0.* @@192.168.100.10:514

# Alternative: Use derbynetpi hostname (requires proper DNS/hosts setup)
# *.local0.* @@derbynetpi:514

# Keep local copies of critical errors (WARNING and above)
# This ensures we have local backup if network connection fails
local0.warning /var/log/derbynet-local.log

# Optional: Forward only ERROR and CRITICAL logs if bandwidth is limited
# local0.err @@192.168.100.10:514

# Create local log directory with proper permissions
$CreateDirs on
$DirCreateMode 0755
$FileCreateMode 0644

# Rate limiting to prevent network flooding
$SystemLogRateLimitInterval 10
$SystemLogRateLimitBurst 100

# Disk queue for reliability - queue messages if network is down
# This prevents log loss during network outages
$ActionQueueFileName fwdRule1       # unique name prefix for queue files
$ActionQueueMaxDiskSpace 100m       # 100MB max queue size
$ActionQueueSaveOnShutdown on       # save messages to disk on shutdown
$ActionQueueType LinkedList         # run asynchronously
$ActionResumeRetryCount -1          # infinite retries